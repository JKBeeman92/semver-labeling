name: PR Semver Labeling
author: JKBeeman92
description: A simple, configurable action to give semver labeling based on the PR title

branding:
  color: green
  icon: arrow-up

on:
  workflow_call:
    inputs:
      semver_labels:
        required: true
        type: string
        default: '{"majorLabel": "major-release","minorLabel": "minor-release", "patchLabel": "patch-release"}'

jobs:
  check-pr-title:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: |
          npm install @actions/github @actions/core --force

      - name: Check PR title for semver
        id: check_version
        run: node functions/check-semver.js
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SEMVER_LABELS: ${{ inputs.semver_labels }}

      - name: Check Outputs
        run: |
          echo ${{ steps.check_version.outputs.found_match }}
          echo ${{ steps.check_version.outputs.label_to_apply }}

      - name: Label PR
        if: steps.check_version.outputs.found_match == 'true'
        run: gh issue edit "$NUMBER" --add-label "$LABELS"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_REPO: ${{ github.repository }}
          NUMBER: ${{ github.event.number }}
          LABELS: "${{ steps.check_version.outputs.label_to_apply }}"
